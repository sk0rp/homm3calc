<html>
	<head>
		<title>Homm3 damage calculator</title>
		<style>
			input[type=button] { margin-top: 20px }
			.result { padding-left: 20px }
			label { width:280px; display:inline-block; text-align: right; padding-right: 10px }
			label.detail { padding-left:10px; padding-right: 5px; width:auto; display:inline-block }
			input[type=radio] { margin: 0 }
		</style>
		<script>
			var creatures = [{name: "Azure Dragon", value: 78845}, {name: "Crystal Dragon", value: 39338}, {name: "Rust Dragon", value: 26433}, {name: "Faerie Dragon", value: 19580}, {name: "Archangel", value: 8776}, 
				{name: "Black Dragon", value: 8721}, {name: "Gold Dragon", value: 8613}, {name: "Titan", value: 7500}, {name: "Arch Devil", value: 7115}, {name: "Phoenix", value: 6721},
				{name: "Ancient Behemoth", value: 6168}, {name: "Chaos Hydra", value: 5931},  {name: "Devil", value: 5101}, {name: "Angel", value: 5019}, {name: "Green Dragon", value: 4872},
				{name: "Red Dragon", value: 4702}, {name: "Ghost Dragon", value: 4696}, {name: "Firebird", value: 4547}, {name: "Hydra", value: 4120}, {name: "Giant", value: 3718},
				{name: "Bone Dragon", value: 3388}, {name: "Behemoth", value: 3162}, {name: "Naga Queen", value: 2840}, {name: "Dread Knight", value: 2382}, {name: "Champion", value: 2100},
				{name: "Black Knight", value: 2087}, {name: "War Unicorn", value: 2030}, {name: "Naga", value: 2016}, {name: "Magic Elemental", value: 2012}, {name: "Cavalier", value: 1946},
				{name: "Efreet Sultan", value: 1848}, {name: "Unicorn", value: 1806}, {name: "Efreet", value: 1670}, {name: "Psychic Elemental", value: 1669}, {name: "Scorpicore", value: 1589},
				{name: "Manticore", value: 1547}, {name: "Wyvern Monarch", value: 1518}, {name: "Cyclops King", value: 1443}, {name: "Wyvern", value: 1350}, {name: "Cyclops", value: 1266},
				{name: "Pit Lord", value: 1224}, {name: "Enchanter", value: 1210}, {name: "Thunderbird", value: 1106}, {name: "Power Lich", value: 1079}, {name: "Minotaur King", value: 1068},
				{name: "Mighty Gorgon", value: 1028}, {name: "Roc", value: 1027}, {name: "Troll", value: 1024}, {name: "Master Genie", value: 942}, {name: "Gorgon", value: 890},
				{name: "Genie", value: 884}, {name: "Lich", value: 848}, {name: "Minotaur", value: 835}, {name: "Dendroid Soldier", value: 803}, {name: "Vampire Lord", value: 783},
				{name: "Diamond Golem", value: 775}, {name: "Pit Fiend", value: 765}, {name: "Zealot", value: 750}, {name: "Greater Basilisk", value: 714}, {name: "Arch Mage", value: 680},
				{name: "Ogre Mage", value: 672}, {name: "Gold Golem", value: 600}, {name: "Ballista", value: 600}, {name: "Crusader", value: 588}, {name: "Sharpshooter", value: 585},
				{name: "Medusa Queen", value: 577}, {name: "Mage", value: 570}, {name: "Vampire", value: 555}, {name: "Basilisk", value: 552}, {name: "Silver Pegasus", value: 532},
				{name: "Pegasus", value: 518}, {name: "Dendroid Guard", value: 517}, {name: "Medusa", value: 517}, {name: "Catapult", value: 500}, {name: "Magma Elemental", value: 490},
				{name: "Storm Elemental", value: 486}, {name: "Monk", value: 485}, {name: "Horned Demon", value: 480}, {name: "Energy Elemental", value: 470}, {name: "Royal Griffin", value: 448},
				{name: "Swordsman", value: 445}, {name: "Demon", value: 445}, {name: "Ogre", value: 416}, {name: "Iron Golem", value: 412}, {name: "Ammo Cart", value: 400},
				{name: "Arrow Tower", value: 400}, {name: "Cerberus", value: 392}, {name: "Ice Elemental", value: 380}, {name: "Evil Eye", value: 367}, {name: "Hell Hound", value: 357},
				{name: "Air Elemental", value: 356}, {name: "Griffin", value: 351}, {name: "Fire Elemental", value: 345}, {name: "Nomad", value: 345}, {name: "Beholder", value: 336},
				{name: "Grand Elf", value: 331}, {name: "Earth Elemental", value: 330}, {name: "Wraith", value: 315}, {name: "Water Elemental", value: 315}, {name: "Dragon Fly", value: 312},
				{name: "First Aid Tent", value: 300}, {name: "Mummy", value: 270}, {name: "Serpent Fly", value: 268}, {name: "Wight", value: 252}, {name: "Stone Golem", value: 250},
				{name: "Magog", value: 240}, {name: "Orc Chieftain", value: 240}, {name: "Harpy Hag", value: 238}, {name: "Wood Elf", value: 234}, {name: "Battle Dwarf", value: 209},
				{name: "Wolf Raider", value: 203}, {name: "Obsidian Gargoyle", value: 201}, {name: "Orc", value: 192}, {name: "Marksman", value: 184}, {name: "Stone Gargoyle", value: 165},
				{name: "Gog", value: 159}, {name: "Lizard Warrior", value: 156}, {name: "Harpy", value: 154}, {name: "Boar", value: 145}, {name: "Dwarf", value: 138}, 
				{name: "Centaur Captain", value: 138}, {name: "Rogue", value: 135}, {name: "Wolf Rider", value: 130}, {name: "Zombie", value: 128}, {name: "Archer", value: 126},
				{name: "Lizardman", value: 126}, {name: "Halberdier", value: 115}, {name: "Centaur", value: 100}, {name: "Walking Dead", value: 98}, {name: "Sprite", value: 95},
				{name: "Gnoll Marauder", value: 90}, {name: "Skeleton Warrior", value: 85}, {name: "Infernal Troglodyte", value: 84}, {name: "Pikeman", value: 80},
				{name: "Hobgoblin", value: 78}, {name: "Halfling", value: 75}, {name: "Master Gremlin", value: 66}, {name: "Familiar", value: 60}, {name: "Goblin", value: 60},
				{name: "Skeleton", value: 60}, {name: "Troglodyte", value: 59}, {name: "Gnoll", value: 56}, {name: "Pixie", value: 55}, {name: "Imp", value: 50},
				{name: "Gremlin", value: 44}, {name: "Peasant", value: 15}]
		
			function stacks(amount1, amount2, amount3, amount4, amount5, amount6, amount7, amountEnemy, aiValue1, aiValue2, aiValue3, aiValue4, aiValue5, aiValue6, aiValue7, aiValueEnemy) {
				var playerValue = amount1 * aiValue1 + amount2 * aiValue2 + amount3 * aiValue3 + amount4 * aiValue4 + amount5 * aiValue5 + amount6 * aiValue6 + amount7 * aiValue7
				var enemyValue = amountEnemy * aiValueEnemy

				var stacks
				if (playerValue < enemyValue * 0.5) stacks = amountEnemy >=6 ? "6-7" : amountEnemy >=5 ? "5-7" : amountEnemy >=4 ? "4-6" : amountEnemy >=3 ? "3-5" : amountEnemy >=2 ? "2-4" : "1-3"
				else if (playerValue < enemyValue * 0.67) stacks = amountEnemy >=5 ? "5-7" : amountEnemy >=4 ? "4-6" : amountEnemy >=3 ? "3-5" : amountEnemy >=2 ? "2-4" : "1-3"
				else if (playerValue < enemyValue * 1) stacks = amountEnemy >=4 ? "4-6" : amountEnemy >=3 ? "3-5" : amountEnemy >=2 ? "2-4" : "1-3"
				else if (playerValue < enemyValue * 1.5) stacks = amountEnemy >=3 ? "3-5" : amountEnemy >=2 ? "2-4" : "1-3"
				else if (playerValue < enemyValue * 2) stacks = amountEnemy >=2 ? "2-4" : "1-3"
				else stacks = "1-3"
				return stacks
			}
		
			function fillSelectWithAIValue(selectId) {
				select = document.getElementById(selectId)
				for (var i = 0; i < creatures.length; i++) {
					var opt = document.createElement('option');
					opt.innerHTML = creatures[i]["name"];
					opt.value = creatures[i]["value"];
					select.appendChild(opt);
				}
			}
		
			function damage(amount, damage, attack, defense, archery, archeryLevel, offense, offenseLevel, attackerLevel, archeryOffenseSpeciality, adelaBless, deffenderLevel, lucky, trait, hate, cavaliers, hexes, armorer, armorerLevel, armorerSpeciality, shield, shieldLevel, airShield, airShieldLevel, forgetfulness, penalty, obstacle, blinded, blindedLevel, immunity, petrified, paralyzed) {
				var baseDmg = amount * damage
				var I1 = attack >= defense ? 0.05 * (attack - defense) : 0
				var R1 = attack < defense ? 0.025 * (defense - attack) : 0
				var I2 = 0
				if (archery) {
					I2 = archeryLevel == 1 ? 0.10 : archeryLevel == 2 ? 0.25 : 0.50
				} else if (offense) {
					I2 = offenseLevel == 1 ? 0.10 : offenseLevel == 2 ? 0.20 : 0.30
				}
				var I3 = 0
				if (archeryOffenseSpeciality) {
					I3 = 0.05 * I2 * attackerLevel
				} else if (adelaBless) {
					I3 = 0.03 * (attackerLevel / deffenderLevel)
				}
				var I4 = lucky ? 1 : 0
				var I5 = 0
				if (trait) {
					I5 = 1
				} else if (hate) {
					I5 = 0.5
				} else if (cavaliers) {
					I5 = 0.05 * hexes
				}
				var R2 = armorer ? (armorerLevel == 1 ? 0.05 : armorerLevel == 2 ? 0.10 : 0.15) : 0
				var R3 = armorerSpeciality ? 0.05 * R2 * deffenderLevel : 0
				var R4 = 0
				if (shield) {
					R4 = shieldLevel == 1 ? 0.15 : 0.30
				} else if (airShield) {
					R4 = airShieldLevel == 1 ? 0.25 : 0.50
				} else if (forgetfulness) {
					R4 = 0.5
				}
				var R5 = penalty ? 0.5 : 0
				var R6 = obstacle ? 0.5 : 0
				var R7 = blinded ? (blindedLevel == 1 ? 0.5 : 0.75) : 0
				var R8 = 0
				if (immunity) {
					R8 = 0.5
				} else if (petrified) {
					R8 = 0.5
				} else if (paralyzed) {
					R8 = 0.75
				}

				return baseDmg * (1 + I1 + I2 + I3 + I4 + I5) * (1 - R1) * (1 - R2 - R3) * (1 - R4) * (1 - R5) * (1 - R6) * (1 - R7) * (1 - R8)
			}
		 
			function v(elementName) {
				var elements = document.getElementsByName(elementName)
				var firstElement = elements[0]
				console.log(firstElement)
				if (firstElement.tagName === "SELECT") {
					return parseInt(firstElement.options[firstElement.selectedIndex].value);
				} else if (firstElement.type == "text") {
					return parseFloat(firstElement.value)
				} else if (firstElement.type == "checkbox") {
					return firstElement.checked
				} else if (firstElement.type == "radio") {
					for (var i = 0; i < elements.length; i++) {
						if (elements[i].checked) return parseInt(elements[i].value)
					}
					throw "one radio should be checked"
				}
				throw "wrong input type"
			}
		 
			function show(value, elementId) {
				document.getElementById(elementId).innerText = value
			}
		</script>
	</head>
	<body>
		<label for="amount">amount</label><input type="text" name="amount" id="amount" value="1" /><br/>
		<label for="damage">damage</label><input type="text" name="damage" id="damage" value="10" /><br/>
		<label for="attack">attack</label><input type="text" name="attack" id="attack" value="1" /><br/>
		<label for="defense">defense</label><input type="text" name="defense" id="defense" value="1" /><br/>
		<label for="attackerLevel">attacker level</label><input type="text" name="attackerLevel" id="attackerLevel" value="1" /><br/>
		<label for="deffenderLevel">deffender level</label><input type="text" name="deffenderLevel" id="deffenderLevel" value="1" /><br/>
		<label for="archery">archery</label><input type="checkbox" name="archery" id="archery" />
		<label for="archeryBasic" class="detail">basic</label><input type="radio" name="archeryLevel" id="archeryBasic" value="1" checked="checked" />
		<label for="archeryAdvanced" class="detail">advanced</label><input type="radio" name="archeryLevel" id="archeryAdvanced" value="2" />
		<label for="archeryExpert" class="detail">expert</label><input type="radio" name="archeryLevel" id="archeryExpert" value="3" />
		<br/>
		<label for="offense">offense</label><input type="checkbox" name="offense" id="offense" />
		<label for="offenseBasic" class="detail">basic</label><input type="radio" name="offenseLevel" id="offenseBasic" value="1" checked="checked" />
		<label for="offenseAdvanced" class="detail">advanced</label><input type="radio" name="offenseLevel" id="offenseAdvanced" value="2" />
		<label for="offenseExpert" class="detail">expert</label><input type="radio" name="offenseLevel" id="offenseExpert" value="3" />
		<br/>
		<label for="archeryOffenseSpeciality">archery/offense speciality</label><input type="checkbox" name="archeryOffenseSpeciality" id="archeryOffenseSpeciality" /><br/>
		<label for="adelaBless">Adela's bless</label><input type="checkbox" name="adelaBless" id="adelaBless" /><br/>
		<label for="lucky">lucky</label><input type="checkbox" name="lucky" id="lucky" /><br/>
		<label for="trait">death blow/ballista 2x/opposite elemental</label><input type="checkbox" name="trait" id="trait" /><br/>
		<label for="hate">hate</label><input type="checkbox" name="hate" id="hate" /><br/>
		<label for="cavaliers">cavaliers/champions</label><input type="checkbox" name="cavaliers" id="cavaliers" />
		<label for="hexes" class="detail">traveled hexes</label><input type="text" name="hexes" id="hexes" value="1" />
		<br/>
		<label for="armorer">armorer</label><input type="checkbox" name="armorer" id="armorer" />
		<label for="armorerBasic" class="detail">basic</label><input type="radio" name="armorerLevel" id="armorerBasic" value="1" checked="checked" />
		<label for="armorerAdvanced" class="detail">advanced</label><input type="radio" name="armorerLevel" id="armorerAdvanced" value="2" />
		<label for="armorerExpert" class="detail">expert</label><input type="radio" name="armorerLevel" id="armorerExpert" value="3" />
		<br/>
		<label for="armorerSpeciality">armorer speciality</label><input type="checkbox" name="armorerSpeciality" id="armorerSpeciality" /><br/>
		<label for="shield">shield</label><input type="checkbox" name="shield" id="shield" />
		<label for="shieldBasic" class="detail">basic</label><input type="radio" name="shieldLevel" id="shieldBasic" value="1" checked="checked" />
		<label for="shieldAdvanced" class="detail">advanced</label><input type="radio" name="shieldLevel" id="shieldAdvanced" value="2" />
		<label for="shieldExpert" class="detail">expert</label><input type="radio" name="shieldLevel" id="shieldExpert" value="3" />
		<br/>
		<label for="airShield">air shield</label><input type="checkbox" name="airShield" id="airShield" />
		<label for="airShieldBasic" class="detail">basic</label><input type="radio" name="airShieldLevel" id="airShieldBasic" value="1" checked="checked" />
		<label for="airShieldAdvanced" class="detail">advanced</label><input type="radio" name="airShieldLevel" id="airShieldAdvanced" value="2" />
		<label for="airShieldExpert" class="detail">expert</label><input type="radio" name="airShieldLevel" id="airShieldExpert" value="3" />
		<br/>
		<label for="forgetfulness">basic forgetfulness</label><input type="checkbox" name="forgetfulness" id="forgetfulness" /><br/>
		<label for="penalty">range/melee penalty</label><input type="checkbox" name="penalty" id="penalty" /><br/>
		<label for="obstacle">obstacle penalty</label><input type="checkbox" name="obstacle" id="obstacle" /><br/>
		<label for="blinded">blinded</label><input type="checkbox" name="blinded" id="blinded" />
		<label for="blindedBasic" class="detail">basic</label><input type="radio" name="blindedLevel" id="blindedBasic" value="1" checked="checked" />
		<label for="blindedAdvanced" class="detail">advanced</label><input type="radio" name="blindedLevel" id="blindedAdvanced" value="2" />
		<br/>
		<label for="immunity">elementals immunity</label><input type="checkbox" name="immunity" id="immunity" /><br/>
		<label for="petrified">petrified</label><input type="checkbox" name="petrified" id="petrified" /><br/>
		<label for="paralyzed">paralyzed</label><input type="checkbox" name="paralyzed" id="paralyzed" /><br/>
		<input type="button" onClick="show(damage(v('amount'), v('damage'), v('attack'), v('defense'), v('archery'), v('archeryLevel'), v('offense'), v('offenseLevel'), v('attackerLevel'), v('archeryOffenseSpeciality'), v('adelaBless'), v('deffenderLevel'), v('lucky'), v('trait'), v('hate'), v('cavaliers'), v('hexes'), v('armorer'), v('armorerLevel'), v('armorerSpeciality'), v('shield'), v('shieldLevel'), v('airShield'), v('airShieldLevel'), v('forgetfulness'), v('penalty'), v('obstacle'), v('blinded'), v('blindedLevel'), v('immunity'), v('petrified'), v('paralyzed')), 'result')" value="calculate damage" />
		<span id="result" class="result"></span><br/>
	  
		<label for="amount1">slot 1</label><input type="text" name="amount1" id="amount1" value="0" />
		<select name="type1" id="type1"></select>
		<br/>
		<label for="amount2">slot 2</label><input type="text" name="amount2" id="amount2" value="0" />
		<select name="type2" id="type2"></select>
		<br/>
		<label for="amount3">slot 3</label><input type="text" name="amount3" id="amount3" value="0" />
		<select name="type3" id="type3"></select>
		<br/>
		<label for="amount4">slot 4</label><input type="text" name="amount4" id="amount4" value="0" />
		<select name="type4" id="type4"></select>
		<br/>
		<label for="amount5">slot 5</label><input type="text" name="amount5" id="amount5" value="0" />
		<select name="type5" id="type5"></select>
		<br/>
		<label for="amount6">slot 6</label><input type="text" name="amount6" id="amount6" value="0" />
		<select name="type6" id="type6"></select>
		<br/>
		<label for="amount7">slot 7</label><input type="text" name="amount7" id="amount7" value="0" />
		<select name="type7" id="type7"></select>
		<br/>
		<label for="amountEnemy">enemy</label><input type="text" name="amountEnemy" id="amountEnemy" value="1" />
		<select name="typeEnemy" id="typeEnemy"></select>
		<br/>
		<input type="button" value="calculate stacks" onClick="show(stacks(v('amount1'), v('amount2'), v('amount3'), v('amount4'), v('amount5'), v('amount6'), v('amount7'), v('amountEnemy'), v('type1'), v('type2'), v('type3'), v('type4'), v('type5'), v('type6'), v('type7'), v('typeEnemy')), 'resultStacks')">
		<span id="resultStacks" class="result"></span><br/>
		<script>
			fillSelectWithAIValue("type1"); fillSelectWithAIValue("type2"); fillSelectWithAIValue("type3"); fillSelectWithAIValue("type4"); fillSelectWithAIValue("type5"); 
			fillSelectWithAIValue("type6"); fillSelectWithAIValue("type7"); fillSelectWithAIValue("typeEnemy");
		</script>
		
	</body>
</html>